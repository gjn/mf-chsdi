RewriteEngine On
ExpiresActive On

# never cache the api loader
Alias %INSTANCE_ID%/ws/loader.js %PROJECT_DIR%/chsdi/public/loader.js
<Location %INSTANCE_ID%/ws/loader.js>
    ExpiresDefault "access"
    Header merge Cache-Control "no-cache"
    Header unset ETag
    Header unset Last-Modified
</Location>

# non cached urls:
RewriteRule ^%INSTANCE_ID%/ws/(build|lib|GeoAdmin.ux|tests|doc)/(.*)$  %PROJECT_DIR%/chsdi/public/$1/$2

# cached urls:
RewriteRule ^%INSTANCE_ID%/[0-9a-fA-F]*/ws/(build|lib|GeoAdmin.ux)/(.*)$  %PROJECT_DIR%/chsdi/public/$1/$2
<LocationMatch %INSTANCE_ID%/[0-9a-fA-F]*/ws/(build|lib|GeoAdmin.ux)>
    ExpiresDefault "now plus 1 year"
    Header merge Cache-Control "public"

    Header set X-Powered-By http://imgs.xkcd.com/comics/python.png
</LocationMatch>

# web services:
WSGIScriptAlias %INSTANCE_ID%/ws %PROJECT_DIR%/chsdi.wsgi
